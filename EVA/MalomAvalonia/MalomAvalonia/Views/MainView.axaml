<UserControl xmlns="https://github.com/avaloniaui"
             xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
             xmlns:vm="using:MalomAvalonia.ViewModels"
             x:Class="MalomAvalonia.Views.MainView"
             x:DataType="vm:GameViewModel">

    <UserControl.Styles>
        <Style Selector="Button.Circle">
            <Setter Property="Width" Value="100"/>
            <Setter Property="Height" Value="100"/>
            <Setter Property="Template">
                <ControlTemplate>
                    <Grid>
                        <Ellipse Fill="{TemplateBinding Background}"
                                 Stroke="Black"
                                 StrokeThickness="1"/>
                        <ContentPresenter HorizontalAlignment="Center"
                                          VerticalAlignment="Center"/>
                    </Grid>
                </ControlTemplate>
            </Setter>
        </Style>
    </UserControl.Styles>

    <Grid>
        <Canvas Margin="20" Width="900" Height="900" HorizontalAlignment="Left" VerticalAlignment="Top">
            <Line StartPoint="150,150" EndPoint="480,150" Stroke="Black" StrokeThickness="3" />
            <Line StartPoint="480,150" EndPoint="810,150" Stroke="Black" StrokeThickness="3" />
            <Line StartPoint="810,150" EndPoint="810,480" Stroke="Black" StrokeThickness="3" />
            <Line StartPoint="810,480" EndPoint="810,810" Stroke="Black" StrokeThickness="3" />
            <Line StartPoint="810,810" EndPoint="480,810" Stroke="Black" StrokeThickness="3" />
            <Line StartPoint="480,810" EndPoint="150,810" Stroke="Black" StrokeThickness="3" />
            <Line StartPoint="150,810" EndPoint="150,480" Stroke="Black" StrokeThickness="3" />
            <Line StartPoint="150,480" EndPoint="150,150" Stroke="Black" StrokeThickness="3" />

            <Line StartPoint="260,260" EndPoint="480,260" Stroke="Black" StrokeThickness="3" />
            <Line StartPoint="480,260" EndPoint="700,260" Stroke="Black" StrokeThickness="3" />
            <Line StartPoint="700,260" EndPoint="700,480" Stroke="Black" StrokeThickness="3" />
            <Line StartPoint="700,480" EndPoint="700,700" Stroke="Black" StrokeThickness="3" />
            <Line StartPoint="700,700" EndPoint="480,700" Stroke="Black" StrokeThickness="3" />
            <Line StartPoint="480,700" EndPoint="260,700" Stroke="Black" StrokeThickness="3" />
            <Line StartPoint="260,700" EndPoint="260,480" Stroke="Black" StrokeThickness="3" />
            <Line StartPoint="260,480" EndPoint="260,260" Stroke="Black" StrokeThickness="3" />

            <Line StartPoint="370,370" EndPoint="480,370" Stroke="Black" StrokeThickness="3" />
            <Line StartPoint="480,370" EndPoint="590,370" Stroke="Black" StrokeThickness="3" />
            <Line StartPoint="590,370" EndPoint="590,480" Stroke="Black" StrokeThickness="3" />
            <Line StartPoint="590,480" EndPoint="590,590" Stroke="Black" StrokeThickness="3" />
            <Line StartPoint="590,590" EndPoint="480,590" Stroke="Black" StrokeThickness="3" />
            <Line StartPoint="480,590" EndPoint="370,590" Stroke="Black" StrokeThickness="3" />
            <Line StartPoint="370,590" EndPoint="370,480" Stroke="Black" StrokeThickness="3" />
            <Line StartPoint="370,480" EndPoint="370,370" Stroke="Black" StrokeThickness="3" />

            <Line StartPoint="480,150" EndPoint="480,260" Stroke="Black" StrokeThickness="3" />
            <Line StartPoint="810,480" EndPoint="700,480" Stroke="Black" StrokeThickness="3" />
            <Line StartPoint="480,810" EndPoint="480,700" Stroke="Black" StrokeThickness="3" />
            <Line StartPoint="150,480" EndPoint="260,480" Stroke="Black" StrokeThickness="3" />

            <Line StartPoint="480,260" EndPoint="480,370" Stroke="Black" StrokeThickness="3" />
            <Line StartPoint="700,480" EndPoint="590,480" Stroke="Black" StrokeThickness="3" />
            <Line StartPoint="480,700" EndPoint="480,590" Stroke="Black" StrokeThickness="3" />
            <Line StartPoint="260,480" EndPoint="370,480" Stroke="Black" StrokeThickness="3" />

            <ItemsControl x:Name="Board" ItemsSource="{Binding Positions}" Width="900" Height="900">
                <ItemsControl.ItemsPanel>
                    <ItemsPanelTemplate>
                        <Canvas/>
                    </ItemsPanelTemplate>
                </ItemsControl.ItemsPanel>

                <ItemsControl.Styles>
                    <Style Selector="ContentPresenter" x:DataType="vm:PositionViewModel">
                        <Setter Property="Canvas.Left" Value="{Binding X}"/>
                        <Setter Property="Canvas.Top" Value="{Binding Y}"/>
                    </Style>
                </ItemsControl.Styles>

                <ItemsControl.ItemTemplate>
                    <DataTemplate x:DataType="vm:PositionViewModel">
                        <Button Classes="Circle" 
                                x:CompileBindings="False"
                                Background="{Binding Background}"
                                Command="{Binding $parent[ItemsControl].DataContext.PositionClickCommand}"
                                CommandParameter="{Binding Index}"/>
                    </DataTemplate>
                </ItemsControl.ItemTemplate>
            </ItemsControl>
        </Canvas>

        <StackPanel Orientation="Vertical"
                    HorizontalAlignment="Right"
                    VerticalAlignment="Top"
                    Margin="0,150,50,0">
            <TextBlock Text="{Binding InfoText}" FontSize="16" FontWeight="Bold" TextWrapping="Wrap"/>
            
            <Button Content="Uj jatek" Width="200" Height="60" Margin="0,20,0,0"
                    FontSize="16" FontWeight="Bold" Command="{Binding ResetCommand}"/>

            <Button Content="Mentes" Width="200" Height="60" Margin="0,10,0,0"
                    FontSize="16" FontWeight="Bold" Command="{Binding SaveCommand}"/>

            <Button Content="Betoltes" Width="200" Height="60" Margin="0,10,0,0"
                    FontSize="16" FontWeight="Bold" Command="{Binding LoadCommand}"/>
        </StackPanel>
    </Grid>
</UserControl>