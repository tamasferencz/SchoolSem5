<!DOCTYPE html>
<html lang="hu">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>EVA Beugr√≥</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
    <style>
        :root {
            --bg-color: #eef2f5;
            --card-bg: #ffffff;
            --text-main: #2c3e50;
            --text-muted: #6c757d;
            --border-color: #e9ecef;
            --option-hover: #f8f9fa;
            --option-selected-bg: #eff6ff;
            --option-selected-border: #3bf65a;
            --header-border: #f0f0f0;
        }

        /* S√∂t√©t m√≥d v√°ltoz√≥k */
        body.dark-mode {
            --bg-color: #121212;
            --card-bg: #1e1e1e;
            --text-main: #e0e0e0;
            --text-muted: #a0a0a0;
            --border-color: #333333;
            --option-hover: #2d2d2d;
            --option-selected-bg: #205c1a;
            --option-selected-border: #60fa6f;
            --header-border: #2d2d2d;
        }

        body {
            background-color: var(--bg-color);
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            min-height: 100vh;
            display: flex;
            align-items: center;
            justify-content: center;
            margin: 0;
            transition: background-color 0.3s, color 0.3s;
        }

        .main-card {
            background: var(--card-bg);
            color: var(--text-main);
            border-radius: 20px;
            box-shadow: 0 15px 35px rgba(0,0,0,0.1);
            width: 100%;
            max-width: 850px;
            margin: 10px;
            overflow: hidden;
            display: flex;
            flex-direction: column;
            min-height: 700px;
            transition: background-color 0.3s;
        }

        .start-screen, .end-screen {
            padding: 40px;
            text-align: center;
            flex-grow: 1;
            display: flex;
            flex-direction: column;
            justify-content: center;
            align-items: center;
        }

        .quiz-container {
            padding: 0;
            display: none;
            flex-direction: column;
            flex-grow: 1;
        }

        .header-bar {
            background: var(--card-bg);
            border-bottom: 2px solid var(--header-border);
            padding: 15px 30px;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .quiz-content {
            padding: 30px;
            overflow-y: auto;
            flex-grow: 1;
        }

        .question-text {
            font-size: 1.25rem;
            font-weight: 600;
            color: var(--text-main);
            margin-bottom: 20px;
            line-height: 1.4;
        }

        .option-item {
            border: 2px solid var(--border-color);
            border-radius: 12px;
            padding: 12px 16px;
            margin-bottom: 10px;
            cursor: pointer;
            transition: all 0.2s ease;
            display: flex;
            align-items: flex-start;
            background: var(--card-bg);
            color: var(--text-main);
            user-select: none;
        }

        .option-item:hover {
            background-color: var(--option-hover);
            border-color: #ced4da;
        }

        .option-item.selected {
            border-color: var(--option-selected-border);
            background-color: var(--option-selected-bg);
        }

        /* Override st√≠lusok */
        .option-item.override-selected {
            border-color: #ffc107;
            background-color: #fff3cd;
        }
        body.dark-mode .option-item.override-selected {
            background-color: #4d3e08;
            border-color: #ffca2c;
        }

        .form-check-input {
            margin-top: 5px;
            margin-right: 15px;
            transform: scale(1.3);
            flex-shrink: 0;
            cursor: pointer;
        }

        /* Feedback styles */
        .correct-answer { background-color: #d1e7dd !important; border-color: #badbcc !important; color: #0f5132 !important; }
        .wrong-answer { background-color: #f8d7da !important; border-color: #f5c2c7 !important; color: #842029 !important; }
        .missed-answer { border: 2px dashed #198754 !important; background-color: transparent !important; }
        
        body.dark-mode .correct-answer { background-color: #053b23 !important; border-color: #0f5132 !important; color: #86efac !important; }
        body.dark-mode .wrong-answer { background-color: #4c1116 !important; border-color: #842029 !important; color: #fca5a5 !important; }

        .btn-mode {
            padding: 15px 20px;
            border-radius: 12px;
            margin: 10px;
            width: 300px;
            transition: transform 0.2s;
            text-align: left;
            display: flex;
            align-items: center;
        }
        .btn-mode:hover { transform: scale(1.02); }
        .btn-icon { font-size: 1.5rem; margin-right: 15px; }

        textarea.code-export {
            width: 100%;
            height: 200px;
            font-family: monospace;
            font-size: 0.85rem;
            border-radius: 8px;
            border: 1px solid var(--border-color);
            background-color: var(--bg-color);
            color: var(--text-main);
            padding: 10px;
        }

        .override-badge {
            background-color: #ffc107;
            color: #000;
            padding: 5px 10px;
            border-radius: 5px;
            font-weight: bold;
            font-size: 0.8rem;
            margin-left: 10px;
        }

        .cursor-pointer { cursor: pointer; width: 100%; }
        
        /* Ugr√°s gomb st√≠lus */
        .btn-skip {
            background-color: #6c757d;
            border-color: #6c757d;
            color: white;
        }
        .btn-skip:hover {
            background-color: #5a6268;
            border-color: #545b62;
        }

        /* Dark mode toggle button */
        #theme-toggle {
            position: fixed;
            top: 20px;
            right: 20px;
            width: 50px;
            height: 50px;
            border-radius: 50%;
            border: none;
            background: var(--card-bg);
            box-shadow: 0 4px 10px rgba(0,0,0,0.2);
            font-size: 24px;
            cursor: pointer;
            z-index: 1000;
            display: flex;
            align-items: center;
            justify-content: center;
            transition: all 0.3s;
        }
        #theme-toggle:hover {
            transform: rotate(15deg) scale(1.1);
        }
        body.dark-mode #theme-toggle {
            background: #333;
            color: #ffca2c; 
        }

        /* Navig√°ci√≥ */
        .pagination-container {
            display: flex;
            flex-wrap: wrap;
            gap: 5px;
            justify-content: center;
            margin-top: 20px;
            padding-top: 15px;
            border-top: 1px solid var(--border-color);
        }

        .nav-btn {
            width: 35px;
            height: 35px;
            border: 1px solid var(--border-color);
            background-color: var(--card-bg);
            color: var(--text-main);
            border-radius: 6px;
            font-size: 0.85rem;
            display: flex;
            align-items: center;
            justify-content: center;
            cursor: pointer;
            transition: all 0.2s;
            font-weight: 600;
        }

        .nav-btn:hover {
            background-color: var(--option-hover);
            border-color: #aaa;
        }

        .nav-btn.active {
            background-color: var(--option-selected-border);
            color: white;
            border-color: var(--option-selected-border);
        }
        
        body.dark-mode .nav-btn.active {
            background-color: #3bf648;
            color: white;
        }

        /* √öJ: Nyilacsk√°k st√≠lusa */
        .nav-arrow {
            background: none;
            border: none;
            font-size: 1.4rem;
            color: var(--text-main);
            cursor: pointer;
            padding: 0 10px;
            transition: all 0.2s;
            display: inline-flex;
            align-items: center;
            justify-content: center;
            opacity: 0.7;
        }
        .nav-arrow:hover {
            opacity: 1;
            transform: scale(1.2);
            color: var(--option-selected-border);
        }
        .nav-arrow:disabled {
            opacity: 0.2;
            cursor: not-allowed;
            transform: none;
            color: var(--text-muted);
        }

        body.dark-mode .text-muted { color: var(--text-muted) !important; }
        body.dark-mode .text-dark { color: #e0e0e0 !important; }

        .btn-primary {
            background-color: #198754 !important; /* Bootstrap z√∂ld */
            border-color: #198754 !important;
        }
        .btn-primary:hover {
            background-color: #157347 !important; /* S√∂t√©tebb z√∂ld hoverkor */
            border-color: #157347 !important;
        }
        
        .btn-outline-primary {
            color: #198754 !important;
            border-color: #198754 !important;
        }
        .btn-outline-primary:hover {
            background-color: #198754 !important;
            color: white !important;
        }

        /* 2. Radio button √©s Checkbox pip√°k sz√≠ne */
        .form-check-input:checked {
            background-color: #198754 !important;
            border-color: #198754 !important;
        }
        
        /* F√≥kusz effekt (az a kis k√©k dereng√©s kattint√°skor) elt√ºntet√©se/z√∂ld√≠t√©se */
        .form-check-input:focus, .btn:focus {
            box-shadow: 0 0 0 0.25rem rgba(25, 135, 84, 0.25) !important;
        }

        /* 3. Header (fejl√©c) st√≠lus */
        .header-bar {
            border-bottom: 3px solid #198754 !important; /* Z√∂ld cs√≠k alul */
            /* Ha a h√°tteret is z√∂ldesre akarod, vedd ki a kommentjelet a k√∂vi sor el≈ël: */
            /* background-color: #f0fff4 !important; */ 
        }

        /* 4. Egy√©b k√©k elemek (C√≠mek, Kateg√≥ria c√≠mke) */
        .text-primary {
            color: #198754 !important;
        }
        .badge.bg-primary {
            background-color: #198754 !important;
        }
        
    </style>
</head>
<body>

<button id="theme-toggle" onclick="toggleTheme()" title="S√∂t√©t m√≥d v√°lt√°sa">üåô</button>

<div class="main-card">
    
    <div id="start-screen" class="start-screen">
        <h1 class="mb-3 text-primary fw-bold">EVA Beugr√≥</h1>
        <p class="mb-4 text-muted">K√©rd√©sek sz√°ma: <span id="total-q-count" class="fw-bold">...</span></p>
        
        <div class="d-flex flex-column align-items-center">
            <button class="btn btn-outline-primary btn-mode shadow-sm" onclick="startQuiz('linear')">
                <span class="btn-icon">üìã</span>
                <div>
                    <div class="fs-5 fw-bold">Sorrendben</div>
                    <div class="small">V√°laszok keverve (+ Navig√°ci√≥)</div>
                </div>
            </button>

            <button class="btn btn-outline-primary btn-mode shadow-sm" onclick="startQuiz('random')">
                <span class="btn-icon">üîÄ</span>
                <div>
                    <div class="fs-5 fw-bold">V√©letlenszer≈±</div>
                    <div class="small">K√©rd√©sek √©s v√°laszok is keverve</div>
                </div>
            </button>
            
            <hr class="w-50 my-3" style="border-color: var(--border-color);">
            
            <button class="btn btn-warning btn-mode shadow-sm" onclick="startQuiz('override')">
                <span class="btn-icon">üõ†Ô∏è</span>
                <div>
                    <div class="fs-5 fw-bold text-dark">Jav√≠t√≥ m√≥d</div>
                    <div class="small text-dark">Eredeti sorrend, r√∂gz√≠tett v√°laszok</div>
                </div>
            </button>
        </div>
    </div>

    <div id="quiz-container" class="quiz-container">
        <div class="header-bar">
            <div>
                <span class="badge bg-primary fs-6 mb-1" id="category-badge">Kateg√≥ria</span>
                <span id="override-indicator" class="override-badge" style="display:none;">JAV√çT√ì M√ìD</span>
                
                <div class="d-flex align-items-center mt-1">
                    <button class="nav-arrow me-2" id="prev-arrow" onclick="stepQuestion(-1)" title="El≈ëz≈ë k√©rd√©s">‚ùÆ</button>
                    <div class="text-muted small fw-bold">K√©rd√©s <span id="current-count">1</span> / <span id="total-count">0</span></div>
                    <button class="nav-arrow ms-2" id="next-arrow" onclick="stepQuestion(1)" title="K√∂vetkez≈ë k√©rd√©s">‚ùØ</button>
                </div>
            </div>
            
            <div class="text-end">
                <div class="fs-4 fw-bold text-success" id="score-display">0 pont</div>
                <button class="btn btn-sm btn-link text-muted text-decoration-none" onclick="location.reload()">Kil√©p√©s</button>
            </div>
        </div>

        <div class="quiz-content">
            <div class="question-text" id="question-text">Bet√∂lt√©s...</div>
            <div id="options-list"></div>

            <div id="feedback-box" class="alert mt-3" style="display: none; border-radius: 10px;"></div>

            <div class="d-grid gap-2 mt-4">
                <button id="check-btn" class="btn btn-primary btn-lg shadow-sm" onclick="checkAnswer()">Ellen≈ërz√©s</button>
                <button id="next-btn" class="btn btn-outline-primary btn-lg shadow-sm" style="display: none;" onclick="nextQuestion()">K√∂vetkez≈ë k√©rd√©s</button>
                
                <button id="skip-btn" class="btn btn-skip btn-lg shadow-sm" style="display: none;" onclick="skipQuestions()">‚è© +10 Ugr√°s</button>
                
                <button id="save-next-btn" class="btn btn-warning btn-lg shadow-sm fw-bold" style="display: none;" onclick="saveAndNext()">Ment√©s √©s K√∂vetkez≈ë ‚û°</button>
            </div>

            <div id="pagination-wrapper" style="display:none;">
                <div class="text-muted small text-center mt-3">Gyorsugr√°s tizes√©vel:</div>
                <div id="pagination-container" class="pagination-container">
                    </div>
            </div>

        </div>
    </div>

    <div id="end-screen" class="end-screen" style="display: none;">
        <h2 class="mb-4 text-success">Teszt Befejezve! üéâ</h2>
        <div class="display-1 mb-3 fw-bold"><span id="final-score">0</span> <span class="fs-4 text-muted">/ <span id="final-total">0</span></span></div>
        <div class="progress w-50 mb-3" style="height: 10px;">
            <div id="final-progress" class="progress-bar bg-success" role="progressbar" style="width: 0%"></div>
        </div>
        <p class="lead fw-bold text-muted" id="final-percent"></p>
        <button class="btn btn-primary btn-lg mt-4 px-5 rounded-pill shadow" onclick="location.reload()">√öj teszt ind√≠t√°sa</button>
    </div>

    <div id="export-screen" class="end-screen" style="display: none;">
        <h3 class="mb-3 text-warning">Jav√≠t√°s k√©sz! üíæ</h3>
        <p class="text-muted">A m√≥dos√≠t√°saidat tartalmaz√≥ √∫j f√°jl elk√©sz√ºlt.</p>
        
        <div class="alert alert-info small text-start w-100">
            <strong>Teend≈ë:</strong> T√∂ltsd le a f√°jlt <code>questions.js</code> n√©ven, √©s √≠rd fel√ºl vele a r√©git a mapp√°ban.
        </div>

        <button class="btn btn-success btn-lg mb-3 w-100 shadow" onclick="downloadJS()">üì• questions.js Let√∂lt√©se</button>
        
        <p class="small text-muted mb-1">Vagy m√°sold ki a k√≥dot:</p>
        <textarea id="code-output" class="code-export" readonly></textarea>
        <button class="btn btn-outline-secondary btn-sm mt-2" onclick="copyToClipboard()">V√°g√≥lapra m√°sol√°s</button>
        
        <button class="btn btn-link text-muted mt-4" onclick="location.reload()">Vissza a f≈ëoldalra</button>
    </div>
</div>

<script src="questions.js"></script>

<script>
    let currentIdx = 0;
    let score = 0;
    let isChecked = false;
    let quizQuestions = []; 
    let isOverrideMode = false;
    let isLinearMode = false;

    // S√∂t√©t m√≥d kezel√©se
    function toggleTheme() {
        document.body.classList.toggle('dark-mode');
        const btn = document.getElementById('theme-toggle');
        if (document.body.classList.contains('dark-mode')) {
            btn.innerHTML = '‚òÄÔ∏è';
            localStorage.setItem('mi_quiz_theme', 'dark');
        } else {
            btn.innerHTML = 'üåô';
            localStorage.setItem('mi_quiz_theme', 'light');
        }
    }

    // Fisher-Yates kever√©s
    function shuffleArray(array) {
        let currentIndex = array.length, randomIndex;
        while (currentIndex != 0) {
            randomIndex = Math.floor(Math.random() * currentIndex);
            currentIndex--;
            [array[currentIndex], array[randomIndex]] = [array[randomIndex], array[currentIndex]];
        }
        return array;
    }

    window.onload = function() {
        // T√©ma bet√∂lt√©se
        if (localStorage.getItem('mi_quiz_theme') === 'dark') {
            toggleTheme(); // Ez √°tbillenti s√∂t√©tre
        }

        if (typeof questions === 'undefined' || questions.length === 0) {
            alert("Hiba: A questions.js f√°jl hi√°nyzik vagy √ºres! Gy≈ëz≈ëdj meg r√≥la, hogy egy mapp√°ban vannak.");
            return;
        }
        document.getElementById('total-q-count').innerText = questions.length;
    };

    function startQuiz(mode) {
        // M√≥dok be√°ll√≠t√°sa
        isOverrideMode = (mode === 'override');
        isLinearMode = (mode === 'linear'); 
        
        currentIdx = 0;
        score = 0;
        
        document.getElementById('start-screen').style.display = 'none';
        document.getElementById('quiz-container').style.display = 'flex';
        
        const checkBtn = document.getElementById('check-btn');
        const saveBtn = document.getElementById('save-next-btn');
        const scoreDisplay = document.getElementById('score-display');
        const overrideBadge = document.getElementById('override-indicator');
        const navWrapper = document.getElementById('pagination-wrapper');

        if (isOverrideMode) {
            // JAV√çT√ì M√ìD: Eredeti sorrend mindenben
            quizQuestions = questions; // Referencia az eredetire
            checkBtn.style.display = 'none';
            saveBtn.style.display = 'block';
            scoreDisplay.style.display = 'none';
            overrideBadge.style.display = 'inline-block';
            
            createPagination(); // Navig√°ci√≥ l√©trehoz√°sa
            navWrapper.style.display = 'block';

        } else {
            // NORM√ÅL M√ìDOK: M√°solatot haszn√°lunk
            quizQuestions = JSON.parse(JSON.stringify(questions)); 
            
            if (mode === 'random') {
                // Ha Random m√≥d: Keverj√ºk a k√©rd√©sek sorrendj√©t is
                shuffleArray(quizQuestions);
                navWrapper.style.display = 'none'; // Random m√≥dban nincs √©rtelme a fix navig√°ci√≥nak
            } else {
                // Line√°ris m√≥d
                createPagination(); // Navig√°ci√≥ l√©trehoz√°sa
                navWrapper.style.display = 'block';
            }
            
            checkBtn.style.display = 'block';
            saveBtn.style.display = 'none';
            scoreDisplay.style.display = 'block';
            overrideBadge.style.display = 'none';
        }

        document.getElementById('total-count').innerText = quizQuestions.length;
        loadQuestion();
    }

    // Navig√°ci√≥s gombok gener√°l√°sa (als√≥ 10-es s√°v)
    function createPagination() {
        const container = document.getElementById('pagination-container');
        container.innerHTML = '';
        
        const total = quizQuestions.length;
        const buttonCount = Math.ceil(total / 10);

        for (let i = 0; i < buttonCount; i++) {
            const startIdx = i * 10;
            const btn = document.createElement('div');
            btn.className = 'nav-btn';
            btn.innerText = i + 1;
            btn.id = `nav-btn-${i}`;
            btn.title = `${startIdx + 1}. k√©rd√©st≈ël`;
            
            btn.onclick = function() {
                jumpToQuestion(startIdx);
            };
            
            container.appendChild(btn);
        }
    }

    function jumpToQuestion(idx) {
        if (idx >= quizQuestions.length) return;
        currentIdx = idx;
        loadQuestion();
    }
    
    // --- √öJ L√âPTET≈ê FUNKCI√ì A NYILAKHOZ ---
    function stepQuestion(direction) {
        const newIdx = currentIdx + direction;
        if(newIdx >= 0 && newIdx < quizQuestions.length) {
            currentIdx = newIdx;
            loadQuestion();
        }
    }

    // Navig√°ci√≥s gomb akt√≠v √°llapot√°nak friss√≠t√©se
    function updatePaginationStatus() {
        const activeBlock = Math.floor(currentIdx / 10);
        
        document.querySelectorAll('.nav-btn').forEach(btn => btn.classList.remove('active'));
        
        const activeBtn = document.getElementById(`nav-btn-${activeBlock}`);
        if(activeBtn) {
            activeBtn.classList.add('active');
        }
    }

    function loadQuestion() {
        const q = quizQuestions[currentIdx];
        isChecked = false;

        document.getElementById('current-count').innerText = currentIdx + 1;
        document.getElementById('category-badge').innerText = q.category;
        document.getElementById('question-text').innerText = q.question;
        
        const optionsContainer = document.getElementById('options-list');
        optionsContainer.innerHTML = '';
        document.getElementById('feedback-box').style.display = 'none';
        
        // Gombok kezel√©se bet√∂lt√©skor
        if (!isOverrideMode) {
            document.getElementById('check-btn').style.display = 'block';
            document.getElementById('next-btn').style.display = 'none';
            document.getElementById('skip-btn').style.display = 'none'; 
        } 

        // Navig√°ci√≥ friss√≠t√©se (als√≥ s√°v)
        updatePaginationStatus();

        // --- Nyilak √°llapot√°nak friss√≠t√©se ---
        document.getElementById('prev-arrow').disabled = (currentIdx === 0);
        document.getElementById('next-arrow').disabled = (currentIdx === quizQuestions.length - 1);

        const isMulti = q.type === 'multi' || q.correct.length > 1;
        const inputType = isMulti ? 'checkbox' : 'radio';

        // V√°laszopci√≥k el≈ëk√©sz√≠t√©se
        let optionObjects = q.options.map((opt, idx) => {
            return { text: opt, originalIndex: idx };
        });

        // V√ÅLASZOK KEVER√âSE: Csak ha nem jav√≠t√≥ m√≥d
        if (!isOverrideMode) {
            shuffleArray(optionObjects);
        }

        optionObjects.forEach((optObj, visualIdx) => {
            const div = document.createElement('div');
            div.className = 'option-item';
            
            const originalIdx = optObj.originalIndex;

            const input = document.createElement('input');
            input.type = inputType;
            input.className = 'form-check-input';
            input.name = 'option';
            input.value = originalIdx;
            input.id = `opt-${visualIdx}`; 

            if (isOverrideMode && q.correct.includes(originalIdx)) {
                input.checked = true;
                div.classList.add('selected');
                div.classList.add('override-selected');
            }

            div.onclick = function(e) {
                if(isChecked && !isOverrideMode) return;
                
                // Dupla kattint√°s elker√ºl√©se label/input eset√©n
                if (e.target !== input && e.target.tagName !== 'LABEL') {
                    input.checked = !input.checked;
                }

                if (inputType === 'radio' && input.checked) {
                     document.querySelectorAll('input[name="option"]').forEach(i => {
                         if(i !== input) i.checked = false;
                     });
                }
                
                updateSelectionStyles(isOverrideMode);
            };

            const label = document.createElement('label');
            label.className = 'form-check-label cursor-pointer';
            label.htmlFor = `opt-${visualIdx}`;
            label.innerText = optObj.text;

            div.appendChild(input);
            div.appendChild(label);
            optionsContainer.appendChild(div);
        });
    }

    function updateSelectionStyles(isOverride) {
        document.querySelectorAll('.option-item').forEach(div => {
            const input = div.querySelector('input');
            div.classList.remove('selected');
            if(isOverride) div.classList.remove('override-selected');

            if (input.checked) {
                div.classList.add('selected');
                if(isOverride) div.classList.add('override-selected');
            } 
        });
    }

    // --- NORM√ÅL M√ìD ---

    function checkAnswer() {
        const q = quizQuestions[currentIdx];
        const selectedInputs = document.querySelectorAll('input[name="option"]:checked');
        const selectedValues = Array.from(selectedInputs).map(i => parseInt(i.value));

        if (selectedValues.length === 0) {
            alert("K√©rlek v√°lassz legal√°bb egy v√°laszt!");
            return;
        }

        isChecked = true;
        const feedback = document.getElementById('feedback-box');
        
        selectedValues.sort();
        const correctSorted = [...q.correct].sort();
        const isCorrect = JSON.stringify(selectedValues) === JSON.stringify(correctSorted);

        if (isCorrect) {
            score++;
            document.getElementById('score-display').innerText = score + " pont";
            feedback.className = "alert alert-success";
            feedback.innerHTML = "<strong>Helyes v√°lasz! ‚úÖ</strong>";
        } else {
            feedback.className = "alert alert-danger";
            feedback.innerHTML = "<strong>Helytelen v√°lasz! ‚ùå</strong>";
        }
        feedback.style.display = 'block';

        const allOptions = document.querySelectorAll('.option-item');
        allOptions.forEach((div) => {
            div.onclick = null;
            const input = div.querySelector('input');
            input.disabled = true;

            const originalIdx = parseInt(input.value);
            const isSelected = input.checked;
            const isActuallyCorrect = q.correct.includes(originalIdx);

            div.classList.remove('selected');

            if (isActuallyCorrect) {
                div.classList.add('correct-answer');
                if (!isSelected) {
                    div.innerHTML += ' <span class="badge bg-success ms-2 float-end">Ez a helyes</span>';
                    div.classList.add('missed-answer');
                }
            } else if (isSelected) {
                div.classList.add('wrong-answer');
                div.innerHTML += ' <span class="badge bg-danger ms-2 float-end">Hib√°s</span>';
            }
        });

        document.getElementById('check-btn').style.display = 'none';
        document.getElementById('skip-btn').style.display = 'none'; 
        document.getElementById('next-btn').style.display = 'block';
    }

    // Megmaradt a r√©gi ugr√°s gomb is funkci√≥nak
    function skipQuestions() {
        currentIdx += 10;
        if (currentIdx < quizQuestions.length) {
            loadQuestion();
        } else {
            showEndScreen();
        }
    }

    function nextQuestion() {
        currentIdx++;
        if (currentIdx < quizQuestions.length) {
            loadQuestion();
        } else {
            showEndScreen();
        }
    }

    function showEndScreen() {
        document.getElementById('quiz-container').style.display = 'none';
        document.getElementById('end-screen').style.display = 'flex';
        document.getElementById('final-score').innerText = score;
        document.getElementById('final-total').innerText = quizQuestions.length;
        
        const percent = Math.round((score / quizQuestions.length) * 100);
        document.getElementById('final-percent').innerText = `${percent}%-os teljes√≠tm√©ny`;
        document.getElementById('final-progress').style.width = percent + "%";
    }

    // --- JAV√çT√ì M√ìD ---

    function saveAndNext() {
        const selectedInputs = document.querySelectorAll('input[name="option"]:checked');
        const newCorrectIndices = Array.from(selectedInputs).map(i => parseInt(i.value));

        if (newCorrectIndices.length === 0) {
            if(!confirm("Figyelem! Nem jel√∂lt√©l be semmit helyes v√°lasznak. Biztos tov√°bb l√©psz?")) return;
        }

        questions[currentIdx].correct = newCorrectIndices.sort();

        currentIdx++;
        if (currentIdx < questions.length) {
            loadQuestion();
        } else {
            showExportScreen();
        }
    }

    function showExportScreen() {
        document.getElementById('quiz-container').style.display = 'none';
        document.getElementById('export-screen').style.display = 'flex';

        const jsonContent = JSON.stringify(questions, null, 4);
        const jsContent = `const questions = ${jsonContent};`;
        
        document.getElementById('code-output').value = jsContent;
    }

    function downloadJS() {
        const text = document.getElementById('code-output').value;
        const blob = new Blob([text], { type: "text/javascript" });
        const anchor = document.createElement("a");
        anchor.download = "questions.js";
        anchor.href = window.URL.createObjectURL(blob);
        anchor.target = "_blank";
        anchor.style.display = "none";
        document.body.appendChild(anchor);
        anchor.click();
        document.body.removeChild(anchor);
    }

    function copyToClipboard() {
        const copyText = document.getElementById("code-output");
        copyText.select();
        copyText.setSelectionRange(0, 99999); 
        navigator.clipboard.writeText(copyText.value).then(() => {
            alert("K√≥d m√°solva a v√°g√≥lapra!");
        });
    }

</script>

</body>
</html>